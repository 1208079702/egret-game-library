var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);i.prototype=e.prototype,t.prototype=new i},particle;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.matrix=new egret.Matrix,e.reset(),e}return __extends(e,t),e.prototype.reset=function(){this.x=0,this.y=0,this.scale=1,this.rotation=0,this.alpha=1,this.currentTime=0,this.totalTime=1e3},e.prototype.$getMatrix=function(t,e){var i=this.matrix;if(i.identity(),this.rotation%360)var a=this.rotation,r=egret.NumberUtils.cos(a),s=egret.NumberUtils.sin(a);else r=1,s=0;return i.a=r*this.scale,i.b=s*this.scale,i.c=-s*this.scale,i.d=r*this.scale,i.tx=this.x,i.ty=this.y,(t||e)&&(i.tx-=t*i.a+e*i.c,i.ty-=t*i.b+e*i.d),i},e}(egret.HashObject);t.Particle=e,__reflect(e.prototype,"particle.Particle")}(particle||(particle={}));var particle;!function(t){var e=function(e){function i(t,i){var a=e.call(this)||this;return a._pool=[],a.frameTime=0,a.particles={},a._emitterX=0,a._emitterY=0,a.emissionTime=-1,a.maxParticles=200,a.numParticles=0,a.particleClass=null,a.$particleConfig=null,a.gpuRender="webgl"==egret.Capabilities.renderMode,a.particleMeasureRect=new egret.Rectangle,a.transformForMeasure=new egret.Matrix,a.bitmapNodeList=[],egret.nativeRender?(a.initConfig(i,0,0),a.changeTexture(t)):(a.emissionRate=i,a.texture=t,a.$renderNode=new egret.sys.GroupNode,a.$renderNode.cleanBeforeRender=function(){}),a}return __extends(i,e),i.prototype.createNativeDisplayObject=function(){this.$nativeDisplayObject=new egret_native.NativeDisplayObject(10)},i.prototype.initConfig=function(t,e,i){this.$particleConfig=[t,e,i,0,200],this.emissionRate=t,this._emitterX=e,this._emitterY=i},i.prototype.getParticle=function(){var e;return e=this._pool.length?this._pool.pop():this.particleClass?new this.particleClass:new t.Particle},i.prototype.removeParticle=function(t){var e=this.particles[t.hashCode];e&&(t.reset(),delete this.particles[t.hashCode],this._pool.push(t),this.numParticles--,this.gpuRender?this.removeIndexs.push(t.addIndex):this.bitmapNodeList.length>this.numParticles&&(this.bitmapNodeList.length=this.numParticles,this.$renderNode.drawData.length=this.numParticles))},i.prototype.initParticle=function(t){t.x=this.emitterX,t.y=this.emitterY,t.currentTime=0,t.totalTime=1e3},i.prototype.updateRelativeBounds=function(t){t?(null==this.relativeContentBounds&&(this.relativeContentBounds=new egret.Rectangle),this.relativeContentBounds.copyFrom(t),this.relativeContentBounds.x+=this.emitterX,this.relativeContentBounds.y+=this.emitterY):this.relativeContentBounds=null,this.mask=this.relativeContentBounds},Object.defineProperty(i.prototype,"emitterBounds",{get:function(){return this._emitterBounds},set:function(t){this._emitterBounds=t,this.updateRelativeBounds(t),egret.nativeRender&&this.onPropertyChanges()},enumerable:!0,configurable:!0}),i.prototype.onPropertyChanges=function(){this.$nativeDisplayObject.setCustomData(this.$particleConfig)},Object.defineProperty(i.prototype,"emitterX",{get:function(){return this._emitterX},set:function(t){this._emitterX=t,this.updateRelativeBounds(this.emitterBounds),this.gpuRender&&(this.uniforms.uParticleEmitterX=t),egret.nativeRender&&this.onPropertyChanges()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"emitterY",{get:function(){return this._emitterY},set:function(t){this._emitterY=t,this.updateRelativeBounds(this.emitterBounds),this.gpuRender&&(this.uniforms.uParticleEmitterY=t),egret.nativeRender&&this.onPropertyChanges()},enumerable:!0,configurable:!0}),i.prototype.start=function(t){void 0===t&&(t=-1),0!=this.emissionRate&&(this.emissionTime=t,egret.nativeRender?(this.$particleConfig[3]=t,this.$nativeDisplayObject.setCustomData(this.$particleConfig)):(this.timeStamp=egret.getTimer(),egret.startTick(this.update,this)))},i.prototype.stop=function(t){return void 0===t&&(t=!1),egret.nativeRender?void this.$nativeDisplayObject.setStopToParticle(t):(this.emissionTime=0,void(t&&(this.clear(),egret.stopTick(this.update,this))))},i.prototype.update=function(t){var e=t-this.timeStamp;if(this.timeStamp=t,-1==this.emissionTime||this.emissionTime>0){for(this.frameTime+=e;this.frameTime>0;)this.numParticles<this.maxParticles&&this.addOneParticle(),this.frameTime-=this.emissionRate;-1!=this.emissionTime&&(this.emissionTime-=e,this.emissionTime<0&&(this.emissionTime=0))}var i;for(var a in this.particles)i=this.particles[a],i.currentTime<i.totalTime?(this.gpuRender||this.advanceParticle(i,e),i.currentTime+=e):this.removeParticle(i);return this.gpuRender&&(this.pasedTime+=e,this.uniforms.uParticlePasedTime=this.pasedTime),this.$renderDirty=!0,0==this.numParticles&&0==this.emissionTime&&(egret.stopTick(this.update,this),this.dispatchEventWith(egret.Event.COMPLETE)),!1},i.prototype.$measureContentBounds=function(t){if(this.relativeContentBounds)return void t.copyFrom(this.relativeContentBounds);if(this.gpuRender)return void t.setTo(0,0,100,100);var e=egret.Rectangle.create();if(this.numParticles>0){var i,a=this.texture,r=Math.round(a.$getScaleBitmapWidth()),s=Math.round(a.$getScaleBitmapHeight()),n=!0;for(var o in this.particles){i=this.particles[o],this.transformForMeasure.identity(),this.appendTransform(this.transformForMeasure,i.x,i.y,i.scale,i.scale,i.rotation,0,0,r/2,s/2),this.particleMeasureRect.setEmpty(),this.particleMeasureRect.width=r,this.particleMeasureRect.height=s;var l=Region.create();if(l.updateRegion(this.particleMeasureRect,this.transformForMeasure),n)n=!1,e.setTo(l.minX,l.minY,l.maxX-l.minX,l.maxY-l.minY);else{var h=Math.min(e.x,l.minX),c=Math.min(e.y,l.minY),d=Math.max(e.right,l.maxX),u=Math.max(e.bottom,l.maxY);e.setTo(h,c,d-h,u-c)}Region.release(l)}this.lastRect=e,t.setTo(e.x,e.y,e.width,e.height),egret.Rectangle.release(e)}else this.lastRect&&(e=this.lastRect,t.setTo(e.x,e.y,e.width,e.height),egret.Rectangle.release(e),this.lastRect=null)},i.prototype.changeTexture=function(t){this.texture!=t&&(this.texture=t,egret.nativeRender?this.$nativeDisplayObject.setBitmapDataToParticle(t):this.gpuRender?this.$renderNode.image=t.$bitmapData:(this.bitmapNodeList.length=0,this.$renderNode.drawData.length=0))},i.prototype.clear=function(){for(var t in this.particles)this.removeParticle(this.particles[t]);this.numParticles=0,this.gpuRender&&(this.$renderNode.drawData.length=0,this.bitmapNodeList.length=0),this.$renderDirty=!0},i.prototype.addOneParticle=function(){var t=this.getParticle();this.initParticle(t),t.totalTime>0&&(this.particles[t.hashCode]=t,this.numParticles++)},i.prototype.advanceParticle=function(t,e){t.y-=e/6},i.prototype.$updateRenderNode=function(){if(!egret.nativeRender&&!this.gpuRender&&this.numParticles>0){var t,e=this.texture,i=Math.round(e.$getScaleBitmapWidth()),a=Math.round(e.$getScaleBitmapHeight()),r=e.$offsetX,s=e.$offsetY,n=e.$bitmapX,o=e.$bitmapY,l=e.$bitmapWidth,h=e.$bitmapHeight,c=0;for(var d in this.particles){t=this.particles[d];var u=void 0;this.bitmapNodeList[c]||(u=new egret.sys.BitmapNode,this.bitmapNodeList[c]=u,this.$renderNode.addNode(this.bitmapNodeList[c]),u.image=e.$bitmapData,u.imageWidth=e.$sourceWidth,u.imageHeight=e.$sourceHeight,u.drawImage(n,o,l,h,r,s,i,a)),u=this.bitmapNodeList[c],u.matrix=t.$getMatrix(i/2,a/2),u.blendMode=t.blendMode,u.alpha=t.alpha,c++}}},i.prototype.appendTransform=function(t,e,i,a,r,s,n,o,l,h){var c,d;if(s%360){var u=s;c=egret.NumberUtils.cos(u),d=egret.NumberUtils.sin(u)}else c=1,d=0;return n||o?(t.append(egret.NumberUtils.cos(o),egret.NumberUtils.sin(o),-egret.NumberUtils.sin(n),egret.NumberUtils.cos(n),e,i),t.append(c*a,d*a,-d*r,c*r,0,0)):t.append(c*a,d*a,-d*r,c*r,e,i),(l||h)&&(t.tx-=l*t.a+h*t.c,t.ty-=l*t.b+h*t.d),t},i}(egret.DisplayObject);t.ParticleSystem=e,__reflect(e.prototype,"particle.ParticleSystem")}(particle||(particle={}));var regionPool=[],Region=function(){function t(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.width=0,this.height=0,this.area=0}return t.release=function(t){regionPool.push(t)},t.create=function(){var e=regionPool.pop();return e||(e=new t),e},t.prototype.setEmpty=function(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.width=0,this.height=0,this.area=0},t.prototype.updateRegion=function(t,e){if(0==t.width||0==t.height)return void this.setEmpty();var i,a,r,s,n=e,o=n.a,l=n.b,h=n.c,c=n.d,d=n.tx,u=n.ty,p=t.x,m=t.y,g=p+t.width,f=m+t.height;if(1==o&&0==l&&0==h&&1==c)i=p+d-1,a=m+u-1,r=g+d+1,s=f+u+1;else{var v=o*p+h*m+d,y=l*p+c*m+u,P=o*g+h*m+d,R=l*g+c*m+u,x=o*g+h*f+d,V=l*g+c*f+u,b=o*p+h*f+d,T=l*p+c*f+u,F=0;v>P&&(F=v,v=P,P=F),x>b&&(F=x,x=b,b=F),i=(x>v?v:x)-1,r=(P>b?P:b)+1,y>R&&(F=y,y=R,R=F),V>T&&(F=V,V=T,T=F),a=(V>y?y:V)-1,s=(R>T?R:T)+1}this.minX=i,this.minY=a,this.maxX=r,this.maxY=s,this.width=r-i,this.height=s-a,this.area=this.width*this.height},t}();__reflect(Region.prototype,"Region");var particle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.reset=function(){t.prototype.reset.call(this),this.startX=0,this.startY=0,this.velocityX=0,this.velocityY=0,this.radialAcceleration=0,this.tangentialAcceleration=0,this.rotationDelta=0,this.scaleDelta=0},e}(t.Particle);t.GravityParticle=e,__reflect(e.prototype,"particle.GravityParticle")}(particle||(particle={}));var particle;!function(t){var e=function(e){function i(i,a){var r=e.call(this,i,200)||this;return r.$init=!1,r.gpuRender=!1,r.parseConfig(a),r.emissionRate=r.lifespan/r.maxParticles,r.particleClass=t.GravityParticle,r.$init=!0,r}return __extends(i,e),i.prototype.start=function(t){if(void 0===t&&(t=-1),egret.nativeRender){0!=this.emissionRate&&(this.emissionTime=t),this.$particleConfig[2]=t;var i=[],a=0;for(var r in this.$particleConfig)i.push(a++),i.push(this.$particleConfig[r]);this.$nativeDisplayObject.setCustomData(i)}else e.prototype.start.call(this,t)},i.prototype.onPropertyChanges=function(){if(0!=this.$init){var t=[];t.push(0),this.$particleConfig[0]=this._emitterX,t.push(this._emitterX),t.push(1),this.$particleConfig[1]=this._emitterY,t.push(this._emitterY),this.relativeContentBounds&&(t.push(31),this.$particleConfig[31]=this.relativeContentBounds.x,t.push(this.relativeContentBounds.x),t.push(32),this.$particleConfig[32]=this.relativeContentBounds.y,t.push(this.relativeContentBounds.y),t.push(33),this.$particleConfig[33]=this.relativeContentBounds.width,t.push(this.relativeContentBounds.width),t.push(34),this.$particleConfig[34]=this.relativeContentBounds.height,t.push(this.relativeContentBounds.height)),this.$nativeDisplayObject.setCustomData(t)}},i.prototype.parseConfig=function(t){function e(t){return"undefined"==typeof t?0:t}if(!t||139!=t.byteLength)throw"config error";var i=new egret.ByteArray(t),a=i.readUnsignedByte(),r=i.readUTFBytes(a);if("feather"!=r)throw"config error";i.position=12,egret.nativeRender?(this._emitterX=e(i.readFloat()),this.emitterXVariance=e(i.readFloat()),this._emitterY=e(i.readFloat()),this.emitterYVariance=e(i.readFloat())):(this.emitterX=e(i.readFloat()),this.emitterXVariance=e(i.readFloat()),this.emitterY=e(i.readFloat()),this.emitterYVariance=e(i.readFloat())),this.maxParticles=e(i.readUnsignedShort()),this.lifespan=Math.max(.01,e(i.readUnsignedShort())),this.lifespanVariance=e(i.readUnsignedShort()),this.startSize=e(i.readFloat()),this.startSizeVariance=e(i.readFloat()),this.endSize=e(i.readFloat()),this.endSizeVariance=e(i.readFloat()),this.startRotation=e(i.readFloat()),this.startRotationVariance=e(i.readFloat()),this.endRotation=e(i.readFloat()),this.endRotationVariance=e(i.readFloat()),this.startAlpha=e(i.readFloat()),this.startAlphaVariance=e(i.readFloat()),this.endAlpha=e(i.readFloat()),this.endAlphaVariance=e(i.readFloat()),this.gravityX=e(i.readFloat()),this.gravityY=e(i.readFloat()),this.speed=e(i.readFloat()),this.speedVariance=e(i.readFloat()),this.emitAngle=e(i.readFloat()),this.emitAngleVariance=e(i.readFloat()),this.radialAcceleration=e(i.readFloat()),this.radialAccelerationVariance=e(i.readFloat()),this.tangentialAcceleration=e(i.readFloat()),this.tangentialAccelerationVariance=e(i.readFloat());var s=i.readFloat(),n=i.readFloat(),o=i.readFloat(),l=i.readFloat(),h=0!=o&&0!=l;if(h){var c=new egret.Rectangle;c.x=e(s),c.y=e(n),c.width=e(o),c.height=e(l),this.emitterBounds=c}else this.emitterBounds=null;this.particleBlendMode=i.readUnsignedByte(),this.$particleConfig={0:this.emitterX,1:this.emitterY,2:-1,3:this.maxParticles,4:this.emitterXVariance,5:this.emitterYVariance,6:this.gravityX,7:this.gravityY,8:this.speed,9:this.speedVariance,10:this.lifespan,11:this.lifespanVariance,12:this.emitAngle,13:this.emitAngleVariance,14:this.startSize,15:this.startSizeVariance,16:this.endSize,17:this.endSizeVariance,18:this.startRotation,19:this.startRotationVariance,20:this.endRotation,21:this.endRotationVariance,22:this.radialAcceleration,23:this.radialAccelerationVariance,24:this.tangentialAcceleration,25:this.tangentialAccelerationVariance,26:this.startAlpha,27:this.startAlphaVariance,28:this.endAlpha,29:this.endAlphaVariance,30:this.particleBlendMode,31:h?this.relativeContentBounds.x:0,32:h?this.relativeContentBounds.y:0,33:h?this.relativeContentBounds.width:0,34:h?this.relativeContentBounds.height:0,35:0}},i.prototype.initParticle=function(t){var e=t,a=i.getValue(this.lifespan,this.lifespanVariance);if(e.currentTime=0,e.totalTime=a>0?a:0,!(0>=a)){e.x=i.getValue(this.emitterX,this.emitterXVariance),e.y=i.getValue(this.emitterY,this.emitterYVariance),e.startX=this.emitterX,e.startY=this.emitterY;var r=i.getValue(this.emitAngle,this.emitAngleVariance),s=i.getValue(this.speed,this.speedVariance);e.velocityX=s*egret.NumberUtils.cos(r),e.velocityY=s*egret.NumberUtils.sin(r),e.radialAcceleration=i.getValue(this.radialAcceleration,this.radialAccelerationVariance),e.tangentialAcceleration=i.getValue(this.tangentialAcceleration,this.tangentialAccelerationVariance);var n=i.getValue(this.startSize,this.startSizeVariance);.1>n&&(n=.1);var o=i.getValue(this.endSize,this.endSizeVariance);.1>o&&(o=.1);var l=this.texture.textureWidth;e.scale=n/l,e.scaleDelta=(o-n)/a/l;var h=i.getValue(this.startRotation,this.startRotationVariance),c=i.getValue(this.endRotation,this.endRotationVariance);e.rotation=h,e.rotationDelta=(c-h)/a;var d=i.getValue(this.startAlpha,this.startAlphaVariance),u=i.getValue(this.endAlpha,this.endAlphaVariance);e.alpha=d,e.alphaDelta=(u-d)/a,e.blendMode=this.particleBlendMode}},i.getValue=function(t,e){return t+e*(2*Math.random()-1)},i.prototype.advanceParticle=function(t,e){var i=t;e/=1e3;var a=i.totalTime-i.currentTime;e=a>e?e:a;var r=i.x-i.startX,s=i.y-i.startY,n=Math.sqrt(r*r+s*s);.01>n&&(n=.01);var o=r/n,l=s/n,h=o,c=l;o*=i.radialAcceleration,l*=i.radialAcceleration;var d=h;h=-c*i.tangentialAcceleration,c=d*i.tangentialAcceleration,i.velocityX+=e*(this.gravityX+o+h),i.velocityY+=e*(this.gravityY+l+c),i.x+=i.velocityX*e,i.y+=i.velocityY*e,i.scale+=i.scaleDelta*e*1e3,i.scale<0&&(i.scale=0),i.rotation+=i.rotationDelta*e*1e3,i.alpha+=i.alphaDelta*e*1e3},i}(t.ParticleSystem);t.GravityParticleSystem=e,__reflect(e.prototype,"particle.GravityParticleSystem")}(particle||(particle={}));var particle;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.reset=function(){t.prototype.reset.call(this),this.emitRadius=0,this.emitRadiusDelta=0,this.emitRotation=0,this.emitRotationDelta=0,this.rotationDelta=0,this.scaleDelta=0,this.alphaDelta=0},e}(t.Particle);t.RadiusParticle=e,__reflect(e.prototype,"particle.RadiusParticle")}(particle||(particle={}));var particle;!function(t){var e=function(e){function i(i,a){var r=e.call(this,i,200)||this;if(r.gpuRender){r.$renderNode=new egret.sys.ParticleNode;var s="attribute vec2 aParticlePosition;\nattribute vec2 aParticleTextureCoord;\nattribute vec2 aParticleScale;\nattribute vec2 aParticleRotation;\nattribute vec2 aParticleRed;\nattribute vec2 aParticleGreen;\nattribute vec2 aParticleBlue;\nattribute vec2 aParticleAlpha;\nattribute vec2 aParticleEmitRotation;\nattribute vec2 aParticleEmitRadius;\nattribute vec2 aParticleTime;\nuniform vec2 projectionVector;\nuniform vec2 uTextureSize;\nuniform mat3 uGlobalMatrix;\nuniform float uGlobalAlpha;\nuniform float uParticleEmitterX;\nuniform float uParticleEmitterY;\nuniform float uParticlePasedTime;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void) {\n   vTextureCoord = aParticleTextureCoord;\n   float dt;\n   if(uParticlePasedTime > aParticleTime.x + aParticleTime.y) {\n       return;\n   }\n   else {\n       dt = uParticlePasedTime - aParticleTime.x;\n   }\n   float globalA = uGlobalMatrix[0][0];\n   float globalB = uGlobalMatrix[1][0];\n   float globalC = uGlobalMatrix[0][1];\n   float globalD = uGlobalMatrix[1][1];\n   float globalTx = uGlobalMatrix[0][2];\n   float globalTy = uGlobalMatrix[1][2];\n   float scale = aParticleScale.x + aParticleScale.y * dt;\n   float rotation = aParticleRotation.x + aParticleRotation.y * dt;\n   float cos2 = cos(rotation);\n   float sin2 = sin(rotation);\n   float localA = cos2 * scale;\n   float localB = sin2 * scale;\n   float localC = -sin2 * scale;\n   float localD = cos2 * scale;\n   float emitRotation = aParticleEmitRotation.x + aParticleEmitRotation.y * dt;\n   float emitRadius = aParticleEmitRadius.x + aParticleEmitRadius.y * dt;\n   float localTx = uParticleEmitterX - cos(emitRotation) * emitRadius;\n   float localTy = uParticleEmitterY - sin(emitRotation) * emitRadius;\n   localTx -= uTextureSize.x / 2.0 * localA + uTextureSize.y / 2.0 * localC;\n   localTy -= uTextureSize.x / 2.0 * localB + uTextureSize.y / 2.0 * localD;\n   float finalA = localA * globalA + localB * globalC;\n   float finalB = localA * globalB + localB * globalD;\n   float finalC = localC * globalA + localD * globalC;\n   float finalD = localC * globalB + localD * globalD;\n   float finalTx = localTx * globalA + localTy * globalC + globalTx;\n   float finalTy = localTx * globalB + localTy * globalD + globalTy;\n   float positionX = finalA * uTextureSize.x * aParticlePosition.x + finalC * uTextureSize.y * aParticlePosition.y + finalTx;\n   float positionY = finalD * uTextureSize.y * aParticlePosition.y + finalB * uTextureSize.x * aParticlePosition.x + finalTy;\n   gl_Position = vec4(positionX / projectionVector.x - 1.0, positionY / projectionVector.y + 1.0, 0.0, 1.0);\n   float red = aParticleRed.x + aParticleRed.y * dt;\n   float green = aParticleGreen.x + aParticleGreen.y * dt;\n   float blue = aParticleBlue.x + aParticleBlue.y * dt;\n   float alpha = aParticleAlpha.x + aParticleAlpha.y * dt;\n   vColor = vec4(red, green, blue, alpha) * uGlobalAlpha;\n}",n="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(void) {\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n   gl_FragColor.rgb *= vColor.a;\n}";r.uniforms={uGlobalMatrix:null,uGlobalAlpha:null};var o=new egret.CustomFilter(s,n,r.uniforms);r.filters=[o]}return r.parseConfig(a),r.particleClass=t.RadiusParticle,r}return __extends(i,e),i.prototype.parseConfig=function(t){function e(t){return"undefined"==typeof t?0:t}if(!t||179!=t.byteLength)throw"config error";var i=new egret.ByteArray(t),a=i.readUnsignedByte(),r=i.readUTFBytes(a);if("feather"!=r)throw"config error";i.position=12,egret.nativeRender?(this._emitterX=e(i.readFloat()),this.emitterXVariance=e(i.readFloat()),this._emitterY=e(i.readFloat()),this.emitterYVariance=e(i.readFloat())):(this.emitterX=e(i.readFloat()),this.emitterXVariance=e(i.readFloat()),this.emitterY=e(i.readFloat()),this.emitterYVariance=e(i.readFloat())),this.maxParticles=e(i.readUnsignedShort()),this.lifespan=Math.max(.01,e(i.readUnsignedShort())),this.lifespanVariance=e(i.readUnsignedShort()),this.startSize=e(i.readFloat()),this.startSizeVariance=e(i.readFloat()),this.endSize=e(i.readFloat()),this.endSizeVariance=e(i.readFloat()),this.startRotation=e(i.readFloat()),this.startRotationVariance=e(i.readFloat()),this.endRotation=e(i.readFloat()),this.endRotationVariance=e(i.readFloat()),this.startRed=e(i.readFloat()),this.startRedVariance=e(i.readFloat()),this.endRed=e(i.readFloat()),this.endRedVariance=e(i.readFloat()),this.startGreen=e(i.readFloat()),this.startGreenVariance=e(i.readFloat()),this.endGreen=e(i.readFloat()),this.endGreenVariance=e(i.readFloat()),this.startBlue=e(i.readFloat()),this.startBlueVariance=e(i.readFloat()),this.endBlue=e(i.readFloat()),this.endBlueVariance=e(i.readFloat()),this.startAlpha=e(i.readFloat()),this.startAlphaVariance=e(i.readFloat()),this.endAlpha=e(i.readFloat()),this.endAlphaVariance=e(i.readFloat()),this.maxRadius=e(i.readFloat()),this.maxRadiusVariance=e(i.readFloat()),this.minRadius=e(i.readFloat()),this.minRadiusVariance=e(i.readFloat()),this.emitRotation=e(i.readFloat()),this.emitRotationVariance=e(i.readFloat()),this.emitRotationDelta=e(i.readFloat()),this.emitRotationDeltaVariance=e(i.readFloat());var s=i.readFloat(),n=i.readFloat(),o=i.readFloat(),l=i.readFloat();if(0!=o&&0!=l){var h=new egret.Rectangle;h.x=e(s),h.y=e(n),h.width=e(o),h.height=e(l),this.emitterBounds=h}else this.emitterBounds=null;if(this.particleBlendMode=i.readUnsignedByte(),this.emissionRate=this.lifespan/this.maxParticles,this.gpuRender){this.numProperties=22;for(var c=new Float32Array(this.numProperties*this.maxParticles*4),d=void 0,u=0;u<this.maxParticles;u++)d=u*this.numProperties*4,c[d+0*this.numProperties+0]=0,c[d+0*this.numProperties+1]=0,c[d+0*this.numProperties+2]=0,c[d+0*this.numProperties+3]=0,c[d+1*this.numProperties+0]=1,c[d+1*this.numProperties+1]=0,c[d+1*this.numProperties+2]=1,c[d+1*this.numProperties+3]=0,c[d+2*this.numProperties+0]=1,c[d+2*this.numProperties+1]=1,c[d+2*this.numProperties+2]=1,c[d+2*this.numProperties+3]=1,c[d+3*this.numProperties+0]=0,c[d+3*this.numProperties+1]=1,c[d+3*this.numProperties+2]=0,c[d+3*this.numProperties+3]=1;this.vertices=c,this.$renderNode.vertices=c,this.$renderNode.numParticles=this.maxParticles,this.$renderNode.numProperties=this.numProperties,this.$renderNode.image=this.texture.$bitmapData,this.$renderNode.blendMode=this.particleBlendMode,this.verticesIndex=0,this.removeIndexs=[],this.pasedTime=0}},i.prototype.initParticle=function(t){var e=t,a=i.getValue(this.lifespan,this.lifespanVariance);if(e.currentTime=0,e.totalTime=a>0?a:0,!(0>=a)){e.x=i.getValue(this.emitterX,this.emitterXVariance),e.y=i.getValue(this.emitterY,this.emitterYVariance);var r=i.getValue(this.startSize,this.startSizeVariance);.1>r&&(r=.1);var s=i.getValue(this.endSize,this.endSizeVariance);.1>s&&(s=.1);var n=this.texture.textureWidth;e.scale=r/n,e.scaleDelta=(s-r)/a/n;var o=i.getValue(this.startRotation,this.startRotationVariance),l=i.getValue(this.endRotation,this.endRotationVariance);e.rotation=o,e.rotationDelta=(l-o)/a;var h=i.getValue(this.startRed,this.startRedVariance,!0),c=i.getValue(this.endRed,this.endRedVariance,!0);e.red=h,e.redDelta=(c-h)/a;var d=i.getValue(this.startGreen,this.startGreenVariance,!0),u=i.getValue(this.endGreen,this.endGreenVariance,!0);e.green=d,e.greenDelta=(u-d)/a;var p=i.getValue(this.startBlue,this.startBlueVariance,!0),m=i.getValue(this.endBlue,this.endBlueVariance,!0);e.blue=p,e.blueDelta=(m-p)/a;var g=i.getValue(this.startAlpha,this.startAlphaVariance,!0),f=i.getValue(this.endAlpha,this.endAlphaVariance,!0);e.alpha=g,e.alphaDelta=(f-g)/a,e.blendMode=this.particleBlendMode;var v=i.getValue(this.maxRadius,this.maxRadiusVariance),y=i.getValue(this.minRadius,this.minRadiusVariance);if(e.emitRadius=v,e.emitRadiusDelta=(y-v)/a,e.emitRotation=i.getValue(this.emitRotation,this.emitRotationVariance),e.emitRotationDelta=i.getValue(this.emitRotationDelta,this.emitRotationDeltaVariance),this.gpuRender){var P=void 0;this.removeIndexs.length?P=this.removeIndexs.pop():(P=this.verticesIndex,this.verticesIndex++);var R=this.vertices,x=P*this.numProperties*4,V=t;V.addIndex=P;for(var b=0;4>b;b++)R[x+b*this.numProperties+4]=V.scale,R[x+b*this.numProperties+5]=V.scaleDelta,R[x+b*this.numProperties+6]=V.rotation/180*Math.PI,R[x+b*this.numProperties+7]=V.rotationDelta/180*Math.PI,R[x+b*this.numProperties+8]=V.red,R[x+b*this.numProperties+9]=V.redDelta,R[x+b*this.numProperties+10]=V.green,R[x+b*this.numProperties+11]=V.greenDelta,R[x+b*this.numProperties+12]=V.blue,R[x+b*this.numProperties+13]=V.blueDelta,R[x+b*this.numProperties+14]=V.alpha,R[x+b*this.numProperties+15]=V.alphaDelta,R[x+b*this.numProperties+16]=V.emitRotation,R[x+b*this.numProperties+17]=V.emitRotationDelta,R[x+b*this.numProperties+18]=V.emitRadius,R[x+b*this.numProperties+19]=V.emitRadiusDelta,R[x+b*this.numProperties+20]=this.pasedTime,R[x+b*this.numProperties+21]=V.totalTime}}},i.getValue=function(t,e,i){void 0===i&&(i=!1);var a=t+e*(2*Math.random()-1);return i&&(a=Math.max(0,a),a=Math.min(a,1)),a},i.prototype.advanceParticle=function(t,e){var i=t;e/=1e3;var a=i.totalTime-i.currentTime;e=a>e?e:a,i.emitRotation+=i.emitRotationDelta*e*1e3,i.emitRadius+=i.emitRadiusDelta*e*1e3,i.x=this.emitterX-Math.cos(i.emitRotation)*i.emitRadius,i.y=this.emitterY-Math.sin(i.emitRotation)*i.emitRadius,i.scale+=i.scaleDelta*e*1e3,i.scale<0&&(i.scale=0),i.rotation+=i.rotationDelta*e*1e3,i.alpha+=i.alphaDelta*e*1e3},i}(t.ParticleSystem);t.RadiusParticleSystem=e,__reflect(e.prototype,"particle.RadiusParticleSystem")}(particle||(particle={}));